import os
import subprocess
import lamp_dvfs


##

cpu_freq_list = [200000,300000,400000,500000,600000,700000,800000,900000,1000000,1100000,1200000,1300000,1400000]
gpu_freq_list = [600000000,543000000,480000000,420000000,350000000,266000000,177000000]
mem_freq_list = [165000000,206000000,275000000,413000000,543000000,633000000,728000000,825000000]

# gpu driven governor setting
gpu_cluster = {
    600000000: {'cpu':1400000 , 'mem':825000000},
    543000000: {'cpu':1200000 , 'mem':728000000},
    480000000: {'cpu':1000000 , 'mem':633000000},
    420000000: {'cpu':800000 , 'mem':543000000},
    350000000: {'cpu':600000 , 'mem':413000000},
    266000000: {'cpu':400000 , 'mem':275000000},
    177000000: {'cpu':200000 , 'mem':165000000}
 }

# memory driven governor setting
mem_cluster = {
    165000000: {'gpu':177000000, 'cpu':200000},
    206000000: {'gpu':177000000, 'cpu':400000},
    275000000: {'gpu':266000000, 'cpu':600000},
    413000000: {'gpu':350000000, 'cpu':800000},
    543000000: {'gpu':420000000, 'cpu':1000000},
    633000000: {'gpu':480000000, 'cpu':1100000},
    728000000: {'gpu':543000000, 'cpu':1200000},
    825000000: {'gpu':600000000, 'cpu':1400000}
}
# cpu driven governor setting
cpu_cluster = {
    200000: {'gpu':177000000, 'mem':165000000},
    300000: {'gpu':177000000, 'mem':165000000},
    400000: {'gpu':177000000, 'mem':165000000},
    500000: {'gpu':266000000, 'mem':275000000},
    600000: {'gpu':266000000, 'mem':275000000},
    700000: {'gpu':350000000, 'mem':413000000},
    800000: {'gpu':350000000, 'mem':413000000},
    900000: {'gpu':420000000, 'mem':543000000},
    1000000: {'gpu':420000000, 'mem':543000000},
    1100000: {'gpu':480000000, 'mem':633000000},
    1200000: {'gpu':480000000, 'mem':633000000},
    1300000: {'gpu':600000000, 'mem':825000000},
    1400000: {'gpu':600000000, 'mem':825000000}
}

cpu_nu05_cluster0 = {
    200000: {'gpu':600000000, 'mem':543000000},
    300000: {'gpu':350000000, 'mem':633000000},
    400000: {'gpu':177000000, 'mem':825000000},
    500000: {'gpu':350000000, 'mem':543000000},
    600000: {'gpu':543000000, 'mem':543000000},
    700000: {'gpu':350000000, 'mem':633000000},
    800000: {'gpu':350000000, 'mem':543000000},
    900000: {'gpu':177000000, 'mem':543000000},
    1000000: {'gpu':420000000, 'mem':275000000},
    1100000: {'gpu':480000000, 'mem':275000000},
    1200000: {'gpu':480000000, 'mem':206000000},
    1300000: {'gpu':350000000, 'mem':206000000},
    1400000: {'gpu':177000000, 'mem':165000000}
}

mem_cluster0 = {
    165000000: {'gpu':177000000, 'cpu':1400000},
    206000000: {'gpu':480000000, 'cpu':1200000},
    275000000: {'gpu':420000000, 'cpu':1000000},
    413000000: {'gpu':177000000, 'cpu':900000},
    543000000: {'gpu':543000000, 'cpu':700000},
    633000000: {'gpu':350000000, 'cpu':600000},
    728000000: {'gpu':350000000, 'cpu':500000},
    825000000: {'gpu':177000000, 'cpu':400000}
}


cpu_nu05_cluster1 = {
    200000: {'gpu':480000000, 'mem':543000000},
    300000: {'gpu':480000000, 'mem':633000000},
    400000: {'gpu':177000000, 'mem':825000000},
    500000: {'gpu':350000000, 'mem':543000000},
    600000: {'gpu':350000000, 'mem':543000000},
    700000: {'gpu':350000000, 'mem':633000000},
    800000: {'gpu':350000000, 'mem':543000000},
    900000: {'gpu':177000000, 'mem':633000000},
    1000000: {'gpu':420000000, 'mem':728000000},
    1100000: {'gpu':350000000, 'mem':633000000},
    1200000: {'gpu':350000000, 'mem':825000000},
    1300000: {'gpu':350000000, 'mem':728000000},
    1400000: {'gpu':177000000, 'mem':633000000}
}

'''
Run more clustetring to find the optimal power performance
'''



cpu_adb_cluster05 ={
1200000:{'small':1000000,'gpu':350,'mem':933000},
1300000:{'small':1000000,'gpu':350,'mem':633000},
1400000:{'small':1100000,'gpu':350,'mem':933000},
1500000:{'small':1100000,'gpu':480,'mem':728000},
1600000:{'small':1200000,'gpu':177,'mem':825000},
1700000:{'small':1200000,'gpu':350,'mem':543000},
1800000:{'small':1200000,'gpu':543,'mem':633000},
1900000:{'small':1300000,'gpu':266,'mem':275000},
2000000:{'small':1400000,'gpu':177,'mem':165000}
}

mem_adb_cluster05 = {
165000: {'gpu':177, 'cpu':2000000, 'small':1400000},
206000: {'gpu':480, 'cpu':1900000, 'small':1400000},
275000: {'gpu':420, 'cpu':1800000, 'small':1200000},
413000: {'gpu':177, 'cpu':1700000, 'small':1200000},
543000: {'gpu':543, 'cpu':1700000, 'small':1200000},
633000: {'gpu':350, 'cpu':1600000, 'small':1100000},
728000: {'gpu':350, 'cpu':1500000, 'small':1100000},
825000: {'gpu':266, 'cpu':1400000, 'small':1100000},
933000: {'gpu':177, 'cpu':1200000, 'small':1000000}
}

gpu_adb_cluster05={
543:{'cpu':1200000,	'small':1000000,'mem':543000},
480:{'cpu':1500000,	'small':1100000,'mem':413000},
420:{'cpu':2000000,	'small':1400000,'mem':165000},
350:{'cpu':1700000,	'small':1200000,'mem':543000},
266:{'cpu':1600000,	'small':1200000,'mem':633000},
177:{'cpu':1700000,	'small':1300000,'mem':543000}
}


adb_cpu_clusterNew = {					
1200000:{'gpu':177,'small':1000000,'mem':165000},
1300000:{'gpu':177,'small':1100000,'mem':165000},
1400000:{'gpu':266,'small':1100000,'mem':275000},
1500000:{'gpu':350,'small':1200000,'mem':413000},
1600000:{'gpu':350,'small':1200000,'mem':413000},
1700000:{'gpu':420,'small':1300000,'mem':543000},
1800000:{'gpu':480,'small':1300000,'mem':633000},
1900000:{'gpu':480,'small':1400000,'mem':633000},
2000000:{'gpu':543,'small':1400000,'mem':825000}
}						

adb_gpu_cluster = {						
600:{'cpu':2000000,'small':1400000,'mem':825000},
543:{'cpu':1900000,'small':1400000,'mem':728000},
480:{'cpu':1600000,'small':1200000,'mem':633000},
420:{'cpu':1500000,'small':1200000,'mem':543000},
350:{'cpu':1400000,'small':1200000,'mem':413000},
266:{'cpu':1300000,'small':1100000,'mem':275000},
177:{'cpu':1200000,'small':1000000,'mem':165000}
}						

adb_mem_cluster = {						
165000:{'gpu':177,'small':1000000,'cpu':1200000},
206000:{'gpu':177,'small':1000000,'cpu':1300000},
275000:{'gpu':266,'small':1100000,'cpu':1400000},
413000:{'gpu':350,'small':1200000,'cpu':1500000},
543000:{'gpu':420,'small':1200000,'cpu':1600000},
633000:{'gpu':480,'small':1300000,'cpu':1800000},
728000:{'gpu':480,'small':1400000,'cpu':1900000},
825000:{'gpu':543,'small':1400000,'cpu':2000000},
933000:{'gpu':543,'small':1400000,'cpu':2000000}
}						

adb_cpu_clusterSmall={				
1000000:{'gpu':177,'cpu':1200000,'mem':165000},
1100000:{'gpu':266,'cpu':1400000,'mem':275000},
1200000:{'gpu':350,'cpu':1500000,'mem':413000},
1300000:{'gpu':420,'cpu':1700000,'mem':543000},
1400000:{'gpu':480,'cpu':1900000,'mem':633000}
}						


power_policy = lamp_dvfs.OSLScheduler()
## CPU driven governor
# power_policy.set_cluster(cpu_nu05_cluster1)
power_policy.set_cluster(cpu_cluster)
# power_policy.set_cluster(adb_cpu_clusterSmall)
## Memory driven governor
# power_policy.set_cluster(mem_cluster0)
# GPU driven governor
# power_policy.set_cluster(gpu_cluster)
## run
power_policy.run()
 